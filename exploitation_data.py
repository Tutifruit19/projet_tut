import xarray as xr
import numpy as np
import os

data = xr.open_dataset('recovery_data/test_grille/output.nc')
print(data['t2m'].values)

#cdo -remapnn,lon=43.60/lat=1.43 test.nc output.nc 
#cdo -remapycon,Prevision-T-2-m-EURW1S40-2022100315-ECH-42.nc Prevision-T-2-m-EURAT01-2022100318-ECH-36.nc test.nc
#test: En premier la grille de ref et en deuxieme le fichier a regriller et en troisieme nom du fichier output

def extraction_pt_grille(lat,lon,filename,path,cible):
    #Toulouse lat=43.5866 et lon=1.4605
    os.system("cdo -remapnn,lon="+lon+"/lat="+lat+" "+path+" "+cible+"/remap_"+filename)
    data = xr.open_dataset(cible+"/remap_"+filename)['t2m'].values
    print(data)

#extraction_pt_grille("43.5866","1.4605","Prevision-T-2-m-EURAT01-2022100412-ECH-18.nc","/home/mpma/henona/recovery_data/PE_PEARP0102022100318_2022100506_T_2/Prevision-T-2-m-EURAT01-2022100412-ECH-18.nc")

os.system("mkdir temporaire")
list_files = os.listdir("/home/mpma/henona/recovery_data")
print(list_files)
for x in list_files:
    if x[:2] =='PE':
        list_nc = os.listdir("/home/mpma/henona/recovery_data/"+x)
        print(list_nc)
        os.system("mkdir temporaire/"+x)
        for y in list_nc:
            if y[-2:] =='nc':
                extraction_pt_grille("43.5866","1.4605",y,"/home/mpma/henona/recovery_data/"+x+"/"+y,"temporaire/"+x)
            else:
                pass
    else:
        pass